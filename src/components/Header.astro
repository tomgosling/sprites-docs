---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Header.astro';
---

<Default {...Astro.props}><slot /></Default>

<script>
  function addDashboardLink() {
    const rightGroup = document.querySelector('header.header .right-group');
    if (rightGroup && !rightGroup.querySelector('.dashboard-link')) {
      const link = document.createElement('a');
      link.href = 'https://sprites.dev/account';
      link.className = 'dashboard-link';
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.innerHTML = `Dashboard <svg class="pixel-arrow" viewBox="0 0 36 60" fill="currentColor"><path d="M24 48V36H12v12h12M0 48v12h12V48H0m12-24h12V12H12v12m24 0H24v12h12V24M12 12V0H0v12h12z" /></svg>`;
      rightGroup.appendChild(link);
    }
  }

  function applyGlassmorphism() {
    const header = document.querySelector('header.header') as HTMLElement;
    if (header) {
      const isDark = document.documentElement.dataset.theme !== 'light';
      if (isDark) {
        header.style.backdropFilter = 'blur(16px) saturate(200%) brightness(1.05)';
        header.style.setProperty('-webkit-backdrop-filter', 'blur(16px) saturate(200%) brightness(1.05)');
        header.style.background = 'rgba(12, 10, 9, 0.4)';
        header.style.borderBottom = '1px solid rgba(255, 255, 255, 0.15)';
        header.style.boxShadow = '0 4px 30px rgba(0, 0, 0, 0.2)';
      } else {
        header.style.backdropFilter = 'blur(24px) saturate(200%)';
        header.style.setProperty('-webkit-backdrop-filter', 'blur(24px) saturate(200%)');
        header.style.background = 'rgba(255, 255, 255, 0.25)';
        header.style.borderBottom = '1px solid rgba(0, 0, 0, 0.08)';
        header.style.boxShadow = '0 4px 30px rgba(0, 0, 0, 0.06), inset 0 0 0 1px rgba(255, 255, 255, 0.5)';
      }
    }
  }

  // Watch for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-theme') {
        applyGlassmorphism();
      }
    });
  });
  observer.observe(document.documentElement, { attributes: true });

  addDashboardLink();
  applyGlassmorphism();
  document.addEventListener('astro:page-load', () => {
    addDashboardLink();
    applyGlassmorphism();
  });
</script>

<style is:global>
  .dashboard-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.875rem;
    font-family: 'Fricolage Grotesque', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: -0.01em;
    color: white;
    text-decoration: none;
    background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 0.375rem;
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }

  .dashboard-link:hover {
    background: linear-gradient(180deg, #2dd464 0%, #1eb854 100%);
  }

  .dashboard-link .pixel-arrow {
    width: 0.625rem;
    height: 0.625rem;
    opacity: 0.6;
    transition: opacity 0.15s ease;
  }

  .dashboard-link:hover .pixel-arrow {
    opacity: 1;
  }
</style>
