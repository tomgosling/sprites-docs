---
import type { Props } from '@astrojs/starlight/props';
import SearchDialogWrapper from './react/SearchDialogWrapper';
---

<site-search data-translations={JSON.stringify({})}>
  <button data-open-modal class="search-trigger" aria-label="Search">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8" />
      <path d="m21 21-4.35-4.35" />
    </svg>
    <span class="search-label">Search</span>
    <kbd class="search-kbd">
      <span class="sr-only">Press </span>
      <span>âŒ˜</span>
      <span>K</span>
    </kbd>
  </button>

  <SearchDialogWrapper client:load />
</site-search>

<script>
  class SiteSearch extends HTMLElement {
    constructor() {
      super();

      const openBtn = this.querySelector('[data-open-modal]');

      openBtn?.addEventListener('click', () => {
        this.dispatchEvent(new CustomEvent('open-search', { bubbles: true }));
      });

      // Handle keyboard shortcut
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          this.dispatchEvent(new CustomEvent('open-search', { bubbles: true }));
        }
      });
    }
  }

  customElements.define('site-search', SiteSearch);
</script>

<style>
  site-search {
    display: contents;
  }

  .search-trigger {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: transparent;
    border: none;
    color: var(--sl-color-gray-2);
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.15s ease;
    margin-left: auto;
  }

  .search-trigger:hover {
    color: var(--sl-color-gray-1);
  }

  @media (min-width: 640px) {
    .search-trigger {
      padding: 0.375rem 0.75rem;
      min-width: 12rem;
      justify-content: flex-start;
      background: var(--sl-color-gray-6);
      border: 1px solid var(--sl-color-hairline);
      border-radius: 0.375rem;
    }

    .search-trigger:hover {
      background: var(--sl-color-gray-5);
      border-color: var(--sl-color-gray-4);
    }
  }

  .search-icon {
    width: 1.25rem;
    height: 1.25rem;
    opacity: 0.7;
  }

  @media (min-width: 640px) {
    .search-icon {
      width: 1rem;
      height: 1rem;
    }
  }

  .search-label {
    display: none;
  }

  @media (min-width: 640px) {
    .search-label {
      display: inline;
    }
  }

  .search-kbd {
    display: none;
    align-items: center;
    gap: 0.125rem;
    padding: 0.125rem 0.375rem;
    margin-left: auto;
    font-size: 0.625rem;
    font-family: var(--sl-font-system-mono);
    color: var(--sl-color-gray-3);
    background: var(--sl-color-gray-5);
    border-radius: 0.25rem;
  }

  @media (min-width: 640px) {
    .search-kbd {
      display: inline-flex;
    }
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
</style>
